(function(){var e,t,n,r,i,s,o=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},h={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var r in t)h.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r="SIGNAL",n="OBSERVER",e=["pop","push","reverse","shift","sort","splice","unshift"],s="undefined"!=typeof exports&&null!==exports?exports:this,i=[],s.Signal=function(s){var h,l;return h={definition:null,value:null,dependents:[],dependencies:[],dependencyType:r,observers:[],readers:[],error:null,evaluate:function(e,t){var n,r,s,h,l,u,f,d,p,a,c,v,g;for(c=this.dependencies,l=0,d=c.length;d>l;l++)n=c[l],r=n.dependents.indexOf(this),n.dependents[r]=null;if(this.dependencies=[],this.error=null,this.definition instanceof Function){i.push(this);try{this.value=this.definition()}catch(y){s=y,this.error=s,t.push(s)}finally{i.pop()}}else this.value=this.definition;for(this.readers=[],v=this.observers,u=0,p=v.length;p>u;u++)h=v[u],null!=h&&o.call(e,h)<0&&e.push(h);for(g=this.dependents.slice(0),f=0,a=g.length;a>f;f++)n=g[f],null!=n&&o.call(this.readers,n)<0&&n.evaluate(e,t);return e},read:function(){var e,t;if(e=i[i.length-1],null!=e&&o.call(this.readers,e)<0&&this.readers.push(e),null!=e&&e.dependencyType===r?(o.call(this.dependents,e)<0&&this.dependents.push(e),o.call(e.dependencies,this)<0&&e.dependencies.push(this)):null!=e&&e.dependencyType===n&&(o.call(this.observers,e)<0&&this.observers.push(e),o.call(e.observees,this)<0&&e.observees.push(this)),this.error)throw t=new Error("Reading from corrupted Signal",this.error);return this.value},write:function(n){var r,i,s,o,h,u,f,d,p,a,c,v,g;if(this.definition=n,this.definition instanceof Array)for(u=function(e){return function(t){return l[t]=function(){var n;return n=e.definition[t].apply(e.definition,arguments),e.write(e.definition),n}}}(this),f=0,a=e.length;a>f;f++)s=e[f],u(s);else for(d=0,c=e.length;c>d;d++)s=e[d],delete l[s];for(this.definition instanceof Object?l.set=function(e){return function(t,n){return e.definition[t]=n,e.write(e.definition)}}(this):delete l.set,h=[],i=[],this.evaluate(h,i),g=h.slice(0),p=0,v=g.length;v>p;p++){o=g[p];try{o.trigger()}catch(y){r=y,i.push(r)}}if(1===i.length)throw i[0];if(i.length>1)throw new t(i.length+" errors due to signal write",i);return this.value}},l=function(e){return 0===arguments.length?h.read():h.write(e)},h.write(s),l},s.Observer=function(e){var t,r;return t={response:null,dependencyType:n,observees:[],trigger:function(){var t,n,r,s,o;for(o=this.observees,r=0,s=o.length;s>r;r++)t=o[r],n=t.observers.indexOf(this),t.observers[n]=null;if(this.observees=[],e instanceof Function){i.push(this);try{return this.response()}finally{i.pop()}}},write:function(e){return this.response=e,this.trigger()}},r=function(e){return write(e)},t.write(e),r},t=function(e){function t(e,t){var n,r,i,s,o,h,l,u,f,d,p;for(this.errors=t,d=this.errors,h=0,u=d.length;u>h;h++)n=d[h],r=null!=(p=n.stack)?p:n.toString(),e=e+"\n"+r;for(o=Error.call(this,e),o.name="CompoundError",i=Object.getOwnPropertyNames(o),l=0,f=i.length;f>l;l++)s=i[l],o.hasOwnProperty(s)&&(this[s]=o[s]);return this}return l(t,e),t}(Error),s.CompoundError=t}).call(this);